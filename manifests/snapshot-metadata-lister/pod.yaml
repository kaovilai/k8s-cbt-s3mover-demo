apiVersion: v1
kind: Pod
metadata:
  name: csi-client
  namespace: cbt-demo
spec:
  serviceAccountName: csi-client-sa
  initContainers:
  - name: install-client
    image: golang:1.24.0
    command:
    - /bin/sh
    - -c
    - |
      apt-get update && apt-get install -y git
      git clone https://github.com/kubernetes-csi/external-snapshot-metadata.git /tmp/repo
      cd /tmp/repo/examples/snapshot-metadata-lister
      CGO_ENABLED=0 go build -o /output/snapshot-metadata-lister .
    volumeMounts:
    - name: shared-volume
      mountPath: /output
  containers:
  - name: run-client
    image: busybox:1.37.0
    command:
    - /bin/sh
    - -c
    - "tail -f /dev/null"
    volumeMounts:
    - name: shared-volume
      mountPath: /tools
  volumes:
  - name: shared-volume
    emptyDir: {}
